<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jo Ads - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</title>
    <style>
        :root { --primary: #1a73e8; --secondary: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        nav { background: var(--primary); color: white; padding: 20px; text-align: center; font-weight: bold; font-size: 1.6rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tabs { display: flex; justify-content: center; gap: 10px; padding: 20px; background: white; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-btn { padding: 10px 25px; border-radius: 25px; border: 2px solid var(--primary); background: white; color: var(--primary); cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: auto; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .card-info { padding: 15px; text-align: right; }
        .price { color: var(--secondary); font-size: 1.3rem; font-weight: bold; display: block; margin-bottom: 5px; }
        #adminArea { display: none; position: fixed; bottom: 30px; left: 30px; z-index: 1001; }
        .fab { width: 60px; height: 60px; border-radius: 50%; background: #333; color: white; border: none; font-size: 30px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:2000; padding:10px; }
        .form-card { background:white; padding:25px; border-radius:20px; width:100%; max-width:400px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        .welcome { grid-column: 1/-1; text-align: center; padding: 100px 20px; color: #777; }
    </style>
</head>
<body>

    <nav>Jo Ads - Ø§Ù„Ø£Ø±Ø¯Ù†</nav>

    <div class="tabs">
        <button class="tab-btn active" id="goHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="tab-btn" id="goCars">Ø³ÙŠØ§Ø±Ø§Øª</button>
        <button class="tab-btn" id="goReal">Ø¹Ù‚Ø§Ø±Ø§Øª</button>
    </div>

    <div id="display" class="grid"></div>

    <div id="adminArea">
        <button class="fab" id="openForm">+</button>
    </div>

    <div id="overlay">
        <div class="form-card">
            <h3 style="text-align:center; margin-top:0;">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="titleInp" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
            <input type="text" id="priceInp" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ù…Ø«Ø§Ù„: 5000 Ø¯ÙŠÙ†Ø§Ø±)">
            <input type="number" id="waInp" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (079...)">
            <input type="file" id="fileInp" accept="image/*">
            <select id="catInp">
                <option value="Ø³ÙŠØ§Ø±Ø§Øª">Ø³ÙŠØ§Ø±Ø§Øª</option>
                <option value="Ø¹Ù‚Ø§Ø±Ø§Øª">Ø¹Ù‚Ø§Ø±Ø§Øª</option>
            </select>
            <button id="submitBtn" style="width:100%; background:var(--secondary); color:white; padding:12px; border:none; border-radius:10px; cursor:pointer; font-weight:bold; font-size:1.1rem;">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            <button id="closeForm" style="width:100%; border:none; background:none; margin-top:10px; cursor:pointer; color:#888;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDtYpqqEgrOXV_mEQFEfca15xdTUhcjhkK",
            authDomain: "jo-ads-86c29.firebaseapp.com",
            projectId: "jo-ads-86c29",
            storageBucket: "jo-ads-86c29.firebasestorage.app",
            messagingSenderId: "379301641206",
            appId: "1:379301641206:web:ef0afb32af0ce1986da5d7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let activeTab = "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
        let isAdminMode = false;
        const displayEl = document.getElementById('display');

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ ÙÙ„ØªØ±Ø© Ø¨Ø±Ù…Ø¬ÙŠØ© (ØªØ¶Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙÙˆØ±ÙŠ)
        const loadContent = () => {
            if (activeTab === "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©") {
                displayEl.innerHTML = <div class="welcome"><h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Jo Ads</h2><p>Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„ØªØµÙØ­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p></div>;
                return;
            }

            onSnapshot(collection(db, "ads"), (snapshot) => {
                displayEl.innerHTML = "";
                const filtered = snapshot.docs.filter(d => d.data().category === activeTab);

                if (filtered.length === 0) {
                    displayEl.innerHTML = <div class="welcome"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠ Ù‚Ø³Ù… ${activeTab} Ø­Ø§Ù„ÙŠØ§Ù‹</p></div>;
                    return;
                }

                filtered.forEach((sDoc) => {
                    const ad = sDoc.data();
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${ad.img}" onerror="this.src='https://via.placeholder.com/400x300'">
                        <div class="card-info">
                            <span class="price">${ad.price}</span>
                            <h3 style="margin:0 0 10px 0;">${ad.title}</h3>
                            <a href="https://wa.me/962${ad.phone}" target="_blank" style="text-decoration:none;">
                                <button style="width:100%; background:#25D366; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold;">ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
                            </a>
                        </div>`;
                    
                    if(isAdminMode) {
                        const del = document.createElement('button');
                        del.innerText = "Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ğŸ—‘ï¸";
                        del.style = "background:#ff4d4d; color:white; border:none; width:90%; margin:0 5% 15px 5%; padding:8px; border-radius:8px; cursor:pointer; font-weight:bold;";
                        del.onclick = async () => { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) await deleteDoc(doc(db, "ads", sDoc.id)); };
                        card.appendChild(del);
                    }
                    displayEl.appendChild(card);
                });
            });
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†Ù‚Ù„
        const updateUI = (id, cat) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            activeTab = cat;
            loadContent();
        };

        document.getElementById('goHome').onclick = () => updateUI('goHome', 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
        document.getElementById('goCars').onclick = () => updateUI('goCars', 'Ø³ÙŠØ§Ø±Ø§Øª');
        document.getElementById('goReal').onclick = () => updateUI('goReal', 'Ø¹Ù‚Ø§Ø±Ø§Øª');

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Enter)
        window.onkeydown = (e) => {
            if (e.key === 'Enter') {
                const p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
                if (p === "admin123") {
                    isAdminMode = true;
                    document.getElementById('adminArea').style.display = 'block';
                    loadContent();
                    alert("ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ âœ…");
                }
            }
        };

        document.getElementById('openForm').onclick = () => document.getElementById('overlay').style.display='flex';
        document.getElementById('closeForm').onclick = () => document.getElementById('overlay').style.display='none';

        document.getElementById('submitBtn').onclick = async () => {
            const f = document.getElementById('fileInp').files[0];
            const t = document.getElementById('titleInp').value;
            const p = document.getElementById('priceInp').value;
            const w = document.getElementById('waInp').value;
            const c = document.getElementById('catInp').value;

            if(!f || !t || !w) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            
            document.getElementById('submitBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";
            const fd = new FormData();
            fd.append("file", f); fd.append("upload_preset", "ml_default");

            try {
                const res = await fetch("https://api.cloudinary.com/v1_1/dnm9qjjdg/image/upload", { method: "POST", body: fd });
                const data = await res.json();
                await addDoc(collection(db, "ads"), { title: t, price: p, phone: w, category: c, img: data.secure_url, createdAt: new Date() });
                alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!");
                location.reload();
            } catch (e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£!"); }
        };

        loadContent();
    </script>
</body>
</html>