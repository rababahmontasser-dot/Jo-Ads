<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Jo Ads - اختبار الاتصال المباشر</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; text-align: center; margin: 0; }
        .nav { background: #1a73e8; color: white; padding: 15px; font-size: 20px; }
        .tabs { padding: 15px; background: white; }
        .btn { padding: 10px 20px; cursor: pointer; border: 1px solid #1a73e8; background: white; }
        .btn.active { background: #1a73e8; color: white; }
        .ads-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
        .ad-item { background: white; border-radius: 8px; width: 250px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden; }
        .ad-item img { width: 100%; height: 150px; object-fit: cover; }
    </style>
</head>
<body>

    <div class="nav">Jo Ads - جاري فحص الاتصال...</div>
    
    <div class="tabs">
        <button class="btn" id="goCars">عرض السيارات</button>
        <button class="btn" id="goReal">عرض العقارات</button>
    </div>

    <div id="displayArea" class="ads-list">سيظهر هنا أي شيء موجود في قاعدة البيانات...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDtYpqqEgrOXV_mEQFEfca15xdTUhcjhkK",
            authDomain: "jo-ads-86c29.firebaseapp.com",
            projectId: "jo-ads-86c29",
            storageBucket: "jo-ads-86c29.firebasestorage.app",
            messagingSenderId: "379301641206",
            appId: "1:379301641206:web:ef0afb32af0ce1986da5d7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // وظيفة جلب "كل شيء" بدون استثناء
        function getAllData() {
            const adsCol = collection(db, "ads");
            
            onSnapshot(adsCol, (snapshot) => {
                const area = document.getElementById('displayArea');
                area.innerHTML = "";
                
                if (snapshot.empty) {
                    area.innerHTML = "قاعدة البيانات فارغة تماماً! لم يتم العثور على أي مستند.";
                    return;
                }

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    area.innerHTML += `
                        <div class="ad-item">
                            <img src="${data.img}">
                            <div style="padding:10px">
                                <h3>${data.title}</h3>
                                <p style="color:blue">${data.category}</p>
                            </div>
                        </div>`;
                });
                alert("نجح الاتصال! تم العثور على " + snapshot.size + " إعلانات.");
            }, (error) => {
                alert("فشل Firebase: " + error.message);
                console.error(error);
            });
        }

        // ربط الأزرار لتشغيل الجلب
        document.getElementById('goCars').onclick = () => { getAllData(); };
        document.getElementById('goReal').onclick = () => { getAllData(); };

        // محاولة جلب تلقائي عند الفتح
        getAllData();
    </script>
</body>
</html>